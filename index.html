<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pictionary — French Monuments</title>
<style>
:root{--accent:#1f7ed0}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:18px;background:#f6fbff;color:#0b2433}
.wrap{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:360px 1fr;gap:18px}
.panel{background:white;border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(20,40,60,.06);display:flex;flex-direction:column;}
h1{margin:0 0 12px;font-size:20px}
select,input,button{padding:8px;border-radius:8px;border:1px solid #e6eef9;background:transparent;font-size:13px}
.reference{margin-top:10px;font-size:16px;font-weight:bold}
.reference img{margin-top:8px;max-width:100%;border-radius:8px;border:1px solid #eee}
.toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
#drawCanvas{background:#fff;border-radius:8px;border:1px solid #e6eef9;touch-action:none;width:100%;height:100%;}
.controls{display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap}
.small{font-size:13px;color:#47606f}
.right-top{display:flex;justify-content:space-between;align-items:center}
button.primary{background:var(--accent);color:white;border:none}
.score{font-weight:700;font-size:18px}
</style>
</head>
<body>
<div style="max-width:1200px;margin:0 auto"><h1>Pictionary — French Monuments</h1></div>
<div class="wrap">
<div class="panel">
<div style="display:flex;justify-content:space-between;align-items:center">
<div>
<div class="small">Mode</div>
<select id="modeSelect">
<option value="single">Singleplayer</option>
<option value="duel">1 vs 1</option>
</select>
</div>
<div>
<div class="small">Level</div>
<select id="levelSelect">
<option value="easy">Easy</option>
<option value="medium">Medium</option>
<option value="hard">Hard</option>
</select>
</div>
</div>

<div class="reference" id="referenceBox" style="display:none">
<strong id="topicName"></strong>
<div class="small" id="topicDiff"></div>
<img id="topicImage" alt="Reference image"/>
</div>

<div class="toolbar">
<button id="newBtn">New Topic</button>
<button id="startBtn" class="primary">Start Round (1:30)</button>
<button id="clearBtn">Clear</button>
<button id="resetBtn">Reset</button>
</div>
</div>

<div class="panel" style="display:flex;flex-direction:column;">
<div class="right-top">
<div>
<div class="small">Timer</div>
<div id="timerDisplay" style="font-size:20px;font-weight:700;color:#2563eb">01:30</div>
</div>
<div style="text-align:right">
<div class="small">Score</div>
<div id="scoreDisplay" class="score">—/100</div>
</div>
</div>

<div style="flex:1">
<canvas id="drawCanvas"></canvas>
</div>

<div class="controls">
<label>Brush: <input id="brushSize" type="range" min="1" max="60" value="6"></label>
<label>Opacity: <input id="opacity" type="range" min="0.1" max="1" step="0.1" value="1"></label>
<label>Color: <input id="colorPicker" type="color" value="#000000"></label>
<button id="eraserBtn">Eraser</button>
<button id="penBtn">Pen</button>
<button id="undoBtn">Undo</button>
<button id="redoBtn">Redo</button>
</div>
</div>
</div>

<script>
const TOPICS = {
easy: [
  { name:"Eiffel Tower", img:"images/eiffel.jpg" },
  { name:"Arc de Triomphe", img:"images/arc.jpg" }
],
medium: [
  { name:"Notre-Dame de Paris", img:"images/notre.jpg" },
  { name:"Louvre Pyramid", img:"images/louvre.jpg" }
],
hard: [
  { name:"Panthéon", img:"images/pantheon.jpg" },
  { name:"Arènes de Nîmes", img:"images/arenes.jpg" }
]
};

// UI elements
const modeSelect = document.getElementById('modeSelect');
const levelSelect = document.getElementById('levelSelect');
const newBtn = document.getElementById('newBtn');
const startBtn = document.getElementById('startBtn');
const clearBtn = document.getElementById('clearBtn');
const resetBtn = document.getElementById('resetBtn');
const topicNameEl = document.getElementById('topicName');
const topicDiffEl = document.getElementById('topicDiff');
const topicImgEl = document.getElementById('topicImage');
const referenceBox = document.getElementById('referenceBox');
const timerDisplay = document.getElementById('timerDisplay');
const scoreDisplay = document.getElementById('scoreDisplay');
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
const brushSize = document.getElementById('brushSize');
const opacity = document.getElementById('opacity');
const colorPicker = document.getElementById('colorPicker');
const eraserBtn = document.getElementById('eraserBtn');
const penBtn = document.getElementById('penBtn');
const undoBtn = document.getElementById('undoBtn');
const redoBtn = document.getElementById('redoBtn');

let dpr = window.devicePixelRatio || 1;
function resizeCanvas(){
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;
  ctx.setTransform(1,0,0,1,0,0);
  ctx.scale(dpr,dpr);
}
window.addEventListener('resize', ()=> setTimeout(resizeCanvas,50));
setTimeout(resizeCanvas,50);

// History
let history = [], redoStack = [];
function pushHistory(){
  try{ history.push(canvas.toDataURL()); if(history.length>60) history.shift(); redoStack=[]; }catch(e){}
}
function restoreFromDataURL(dataURL){
  const img = new Image();
  img.onload = ()=>{ ctx.setTransform(1,0,0,1,0,0); ctx.scale(dpr,dpr); ctx.clearRect(0,0,canvas.width/dpr,canvas.height/dpr); ctx.drawImage(img,0,0,canvas.width/dpr,canvas.height/dpr); };
  img.src = dataURL;
}

// Drawing
let drawing=false, erasing=false, started=false, timer=null, timeLeft=90;
ctx.lineCap='round'; ctx.lineJoin='round';
function ptrPos(e){
  const rect = canvas.getBoundingClientRect();
  return { x: e.clientX - rect.left, y: e.clientY - rect.top };
}
canvas.addEventListener('pointerdown', (e)=>{
  drawing=true;
  const p=ptrPos(e);
  ctx.beginPath(); ctx.moveTo(p.x, p.y);
  pushHistory();
  if(!started) startRound();
});
canvas.addEventListener('pointermove', (e)=>{
  if(!drawing) return;
  const p=ptrPos(e);
  ctx.lineTo(p.x,p.y);
  ctx.strokeStyle = erasing ? 'rgba(0,0,0,1)' : colorPicker.value;
  ctx.lineWidth = brushSize.value;
  ctx.globalCompositeOperation = erasing ? 'destination-out' : 'source-over';
  ctx.globalAlpha = opacity.value;
  ctx.stroke();
});
canvas.addEventListener('pointerup', ()=>{ if(drawing){ drawing=false; ctx.closePath(); } });
canvas.addEventListener('pointerleave', ()=>{ if(drawing){ drawing=false; ctx.closePath(); } });

eraserBtn.addEventListener('click', ()=>{ erasing=true; });
penBtn.addEventListener('click', ()=>{ erasing=false; });

undoBtn.addEventListener('click', ()=>{
  if(history.length===0) return;
  const last = history.pop();
  redoStack.push(canvas.toDataURL());
  if(history.length===0){
    ctx.clearRect(0,0,canvas.width/dpr,canvas.height/dpr);
  } else {
    restoreFromDataURL(history[history.length-1]);
  }
});
redoBtn.addEventListener('click', ()=>{
  if(redoStack.length===0) return;
  const next = redoStack.pop();
  history.push(canvas.toDataURL());
  restoreFromDataURL(next);
});

clearBtn.addEventListener('click', ()=>{
  ctx.clearRect(0,0,canvas.width/dpr,canvas.height/dpr);
  pushHistory(); updateScoreDisplay(null);
});
resetBtn.addEventListener('click', resetGame);

// Topic
function pickTopic(level){
  const arr = TOPICS[level] || TOPICS.easy;
  return arr[Math.floor(Math.random()*arr.length)];
}
function setReference(topic, level){
  topicNameEl.textContent = topic.name;
  topicDiffEl.textContent = level.charAt(0).toUpperCase() + level.slice(1);
  topicImgEl.src = topic.img;
  referenceBox.style.display="block";
  updateScoreDisplay(null);
}
newBtn.addEventListener('click', ()=>{
  const t = pickTopic(levelSelect.value);
  setReference(t, levelSelect.value);
  pushHistory();
});
levelSelect.addEventListener('change', ()=>{ newBtn.click(); });

// Timer
function updateTimerDisplay(){
  const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
  const s = (timeLeft%60).toString().padStart(2,'0');
  timerDisplay.textContent = `${m}:${s}`;
}
function startRound(){
  if(started) return;
  started = true;
  timeLeft = 90;
  updateTimerDisplay();
  timer = setInterval(()=>{
    timeLeft--;
    updateTimerDisplay();
    if(timeLeft <= 0){
      clearInterval(timer); timer=null; started=false; endRound();
    }
  },1000);
}
startBtn.addEventListener('click', ()=> startRound());
function endRound(){
  updateScoreDisplay(Math.floor(Math.random()*51)+50);
}
function updateScoreDisplay(percent){
  if(percent === null || percent === undefined) { scoreDisplay.textContent = '—/100'; }
  else { scoreDisplay.textContent = `${percent}/100`; }
}

// Reset
function resetGame(){
  clearInterval(timer); timer=null; started=false; timeLeft=90; updateTimerDisplay();
  ctx.clearRect(0,0,canvas.width/dpr,canvas.height/dpr);
  history=[]; redoStack=[];
  updateScoreDisplay(null);
  topicNameEl.textContent=""; topicDiffEl.textContent=""; topicImgEl.src=""; referenceBox.style.display="none";
}

// Init
window.addEventListener('load', ()=>{ newBtn.click(); updateTimerDisplay(); updateScoreDisplay(null); });
</script>
</body>
</html>
