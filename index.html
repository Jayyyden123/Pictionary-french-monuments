<!DOCTYPE html>
<html>
<head>
  <title>Pictionary French Monuments</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    #reference-image { max-width: 300px; max-height: 200px; display: block; margin-bottom: 1em; border: 1px solid #ccc; }
    #canvas { border: 2px solid #333; }
    #topic { font-size: 1.25em; margin-bottom: 0.5em; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Pictionary - French Monuments</h1>
  <div id="game">
    <div id="topic"></div>
    <img id="reference-image" src="" alt="Reference image" style="display:none;">
    <canvas id="canvas" width="400" height="400"></canvas>
    <br>
    <button id="hostBtn">Host Game</button>
    <input id="roomInput" placeholder="Enter room code" />
    <button id="joinBtn">Join Game</button>
    <div id="status"></div>
    <!-- Add any other elements from your original layout here -->
  </div>
  <script>
    // Topics and image URLs
    const topicsWithImages = {
      "Eiffel Tower": "https://upload.wikimedia.org/wikipedia/commons/a/a8/Tour_Eiffel_Wikimedia_Commons.jpg",
      "Louvre Museum": "https://upload.wikimedia.org/wikipedia/commons/5/5d/Louvre_2007_02_24_c.jpg",
      "Arc de Triomphe": "https://upload.wikimedia.org/wikipedia/commons/6/6a/Arc_de_Triomphe_Paris.jpg",
      "Notre-Dame Cathedral": "https://upload.wikimedia.org/wikipedia/commons/a/a6/Notre-Dame_de_Paris_2013-07-24.jpg"
    };

    // Socket.io setup
    const socket = io("ws://192.168.0.1:3000", { autoConnect: false });

    let myRoom = null;
    let isHost = false;

    // Canvas drawing logic
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let drawing = false;

    canvas.addEventListener("mousedown", e => {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    });

    canvas.addEventListener("mousemove", e => {
      if (drawing) {
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
        // Send drawing event to server
        if (myRoom) {
          socket.emit("draw_event", { room: myRoom, x: e.offsetX, y: e.offsetY, type: "draw" });
        }
      }
    });

    canvas.addEventListener("mouseup", () => {
      drawing = false;
      ctx.closePath();
    });

    // Receive and draw remote events
    socket.on("draw_event", data => {
      if (data.room === myRoom) {
        ctx.lineTo(data.x, data.y);
        ctx.stroke();
      }
    });

    // Topic and image logic
    function setTopic(topic) {
      document.getElementById('topic').textContent = `Monument: ${topic}`;
      const imgUrl = topicsWithImages[topic];
      const imgElem = document.getElementById('reference-image');
      if (imgUrl) {
        imgElem.src = imgUrl;
        imgElem.style.display = 'block';
      } else {
        imgElem.style.display = 'none';
      }
    }

    // Host game
    document.getElementById("hostBtn").onclick = () => {
      const roomId = Math.random().toString(36).substr(2, 6).toUpperCase();
      myRoom = roomId;
      isHost = true;
      socket.connect();
      socket.emit("create_room", roomId);
      document.getElementById("status").textContent = `Hosting! Room code: ${roomId}`;
      // Pick topic and share with room
      const topics = Object.keys(topicsWithImages);
      const topic = topics[Math.floor(Math.random() * topics.length)];
      setTopic(topic);
      socket.emit("topic_sync", { room: myRoom, topic });
    };

    // Join game
    document.getElementById("joinBtn").onclick = () => {
      const roomId = document.getElementById("roomInput").value.trim();
      if (!roomId) {
        document.getElementById("status").textContent = "Please enter a room code.";
        return;
      }
      myRoom = roomId;
      isHost = false;
      socket.connect();
      socket.emit("join_room", roomId);
      document.getElementById("status").textContent = `Joining room ${roomId}...`;
    };

    // Sync topic for joined players
    socket.on("topic_sync", data => {
      if (data.room === myRoom) setTopic(data.topic);
    });

    // Confirm join
    socket.on("room_joined", data => {
      if (data.roomId === myRoom) {
        document.getElementById("status").textContent = "Joined! Ready to play.";
      }
    });

    // Auto clear canvas when topic changes (optional)
    socket.on("topic_sync", () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    // For demo, set a topic and image on load (singleplayer preview)
    window.onload = () => {
      setTopic("Eiffel Tower");
    };
  </script>
</body>
</html>
