<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pictionary — French Monuments (1v1 + Timer Fix)</title>
<style>
  :root{--accent:#1f7ed0}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:18px;background:#f6fbff;color:#0b2433}
  .wrap{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:360px 1fr;gap:18px}
  .panel{background:white;border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(20,40,60,.06)}
  h1{margin:0 0 12px;font-size:20px}
  select,input,button{padding:8px;border-radius:8px;border:1px solid #e6eef9;background:transparent;font-size:13px}
  .reference img{width:100%;height:auto;border-radius:8px;object-fit:contain;background:#f6f8fb}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  #drawCanvas{background:#fff;border-radius:8px;border:1px solid #e6eef9;touch-action:none;width:100%;height:540px}
  .controls{display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap}
  .meter{height:12px;background:#eef6fb;border-radius:999px;overflow:hidden}
  .meter > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#56c2f5);width:0}
  .muted{color:#536873;font-size:13px}
  .small{font-size:13px;color:#47606f}
  .p2p-txt{font-family:monospace;font-size:12px;height:110px;resize:vertical;width:100%}
  .row{display:flex;gap:8px;align-items:center}
  .right-top{display:flex;justify-content:space-between;align-items:center}
  button.primary{background:var(--accent);color:white;border:none}
  .score{font-weight:700;font-size:18px}
</style>
</head>
<body>
<div style="max-width:1200px;margin:0 auto"><h1>Pictionary — French Monuments</h1></div>
<div class="wrap">
  <!-- Left panel -->
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="small">Mode</div>
        <select id="modeSelect">
          <option value="single">Singleplayer</option>
          <option value="local">Local — Pass & Play</option>
          <option value="p2p">1v1 Online (manual P2P)</option>
        </select>
      </div>
      <div>
        <div class="small">Level</div>
        <select id="levelSelect">
          <option value="easy">Easy</option>
          <option value="medium">Medium</option>
          <option value="hard">Hard</option>
        </select>
      </div>
    </div>

    <p class="muted" style="margin-top:10px">Reference (preview)</p>
    <div class="reference" id="referenceBox" style="margin-top:10px">
      <img id="referenceImg" src="" alt="reference"/>
      <div style="margin-top:8px"><strong id="topicName"></strong> · <span id="topicDiff" class="small"></span></div>
    </div>

    <div class="toolbar" style="margin-top:12px">
      <button id="newBtn">New Topic</button>
      <button id="startBtn" class="primary">Start Round (1:30)</button>
      <button id="clearBtn">Clear</button>
    </div>

    <div style="margin-top:12px">
      <div class="small">Timer color</div>
      <select id="timerColor">
        <option value="#e11d48">Red</option>
        <option value="#10b981">Green</option>
        <option value="#2563eb" selected>Blue</option>
        <option value="#f59e0b">Yellow</option>
      </select>
    </div>

    <div style="margin-top:12px" class="muted small">
      <div style="font-weight:700;margin-bottom:6px">Online / P2P (manual signaling)</div>
      <div>Share offer/answer JSON manually to connect with a friend.</div>
      <textarea id="signalingLocal" class="p2p-txt" placeholder="Local offer/answer" readonly></textarea>
      <textarea id="signalingRemote" class="p2p-txt" placeholder="Paste remote offer/answer here"></textarea>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="createOfferBtn">Create Offer</button>
        <button id="acceptRemoteBtn">Accept Remote</button>
        <button id="closeP2PBtn">Close P2P</button>
      </div>
      <div id="p2pStatus" class="small" style="margin-top:8px">P2P status: disconnected</div>
    </div>
  </div>

  <!-- Right panel -->
  <div class="panel">
    <div class="right-top" style="margin-bottom:12px">
      <div>
        <div class="small">Timer</div>
        <div id="timerDisplay" style="font-size:20px;font-weight:700;color:#2563eb">01:30</div>
      </div>
      <div style="text-align:right">
        <div class="small">Score</div>
        <div id="scoreDisplay" class="score">—/100</div>
      </div>
    </div>

    <canvas id="drawCanvas"></canvas>

    <div class="controls" style="margin-top:12px">
      <label>Brush: <input id="brushSize" type="range" min="1" max="60" value="6"></label>
      <label>Opacity: <input id="opacity" type="range" min="0.1" max="1" step="0.1" value="1"></label>
      <label>Color: <input id="colorPicker" type="color" value="#000000"></label>
      <button id="eraserBtn">Eraser</button>
      <button id="penBtn">Pen</button>
      <button id="undoBtn">Undo</button>
      <button id="redoBtn">Redo</button>
    </div>

    <div style="margin-top:12px">
      <div class="meter" aria-hidden><i id="progressBar"></i></div>
      <div style="display:flex;justify-content:space-between;margin-top:6px"><small>50/100 — Minimum</small><small>100/100 — Perfect</small></div>
    </div>
  </div>
</div>

<script>
/* Topics */
const TOPICS = {
  easy: [
    { name: 'Eiffel Tower', src: 'https://upload.wikimedia.org/wikipedia/commons/a/a8/Tour_Eiffel_Wikimedia_Commons.jpg' },
    { name: 'Arc de Triomphe', src: 'https://upload.wikimedia.org/wikipedia/commons/6/6e/Arc_de_Triomphe_Wikimedia_Commons.jpg' }
  ],
  medium: [
    { name: 'Notre-Dame de Paris', src: 'https://upload.wikimedia.org/wikipedia/commons/a/a6/Notre_Dame_de_Paris_2013.jpg' },
    { name: 'Louvre Pyramid', src: 'https://upload.wikimedia.org/wikipedia/commons/a/a6/Louvre_Museum_Wikimedia_Commons.jpg' }
  ],
  hard: [
    { name: 'Sainte-Chapelle', src: 'https://upload.wikimedia.org/wikipedia/commons/4/4f/Sainte-Chapelle_interior.jpg' },
    { name: 'Palace of Versailles', src: 'https://upload.wikimedia.org/wikipedia/commons/9/9a/Versailles_Palace_Wikimedia_Commons.jpg' }
  ]
};

/* DOM */
const levelSelect = document.getElementById('levelSelect');
const newBtn = document.getElementById('newBtn');
const startBtn = document.getElementById('startBtn');
const clearBtn = document.getElementById('clearBtn');
const referenceBox = document.getElementById('referenceBox');
const referenceImg = document.getElementById('referenceImg');
const topicNameEl = document.getElementById('topicName');
const topicDiffEl = document.getElementById('topicDiff');
const timerDisplay = document.getElementById('timerDisplay');
const scoreDisplay = document.getElementById('scoreDisplay');
const progressBar = document.getElementById('progressBar');
const timerColor = document.getElementById('timerColor');
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
const brushSize = document.getElementById('brushSize');
const opacity = document.getElementById('opacity');
const colorPicker = document.getElementById('colorPicker');
const eraserBtn = document.getElementById('eraserBtn');
const penBtn = document.getElementById('penBtn');
const undoBtn = document.getElementById('undoBtn');
const redoBtn = document.getElementById('redoBtn');

/* Canvas setup */
function resizeCanvas(){
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

let drawing=false, erasing=false, timer=null, timeLeft=90, started=false;
ctx.lineCap='round'; ctx.lineJoin='round';

/* Timer */
function updateTimerDisplay(){
  const m=Math.floor(timeLeft/60).toString().padStart(2,'0');
  const s=(timeLeft%60).toString().padStart(2,'0');
  timerDisplay.textContent=`${m}:${s}`;
  timerDisplay.style.color=timerColor.value;
  const pct=((90-timeLeft)/90)*100; progressBar.style.width=pct+'%';
}
function beginTimer(){
  if(started) return; // only once
  started=true;
  timeLeft=90;
  updateTimerDisplay();
  timer=setInterval(()=>{
    timeLeft--; updateTimerDisplay();
    if(timeLeft<=0){ clearInterval(timer); endRound(); }
  },1000);
}

/* Topics */
let currentTopic=null;
function pickTopic(level){
  const arr=TOPICS[level]; return arr[Math.floor(Math.random()*arr.length)];
}
newBtn.addEventListener('click', ()=>{
  currentTopic=pickTopic(levelSelect.value);
  referenceImg.src=currentTopic.src;
  topicNameEl.textContent=currentTopic.name;
  topicDiffEl.textContent=levelSelect.value;
  referenceBox.style.display='block';
  scoreDisplay.textContent='—/100';
});

/* Round */
startBtn.addEventListener('click', ()=>{
  if(!currentTopic){ newBtn.click(); }
  referenceBox.style.display='none';
  beginTimer();
});
function endRound(){
  started=false;
  let score=Math.floor(Math.random()*51)+50; // placeholder scoring
  scoreDisplay.textContent=`${score}/100`;
  progressBar.style.width=score+'%';
}

/* Drawing */
function pos(e){const r=canvas.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top};}
canvas.addEventListener('pointerdown', e=>{drawing=true;ctx.beginPath();const p=pos(e);ctx.moveTo(p.x,p.y);beginTimer();});
canvas.addEventListener('pointermove', e=>{if(!drawing)return;const p=pos(e);ctx.lineTo(p.x,p.y);ctx.strokeStyle=erasing?'#fff':colorPicker.value;ctx.lineWidth=brushSize.value;ctx.globalAlpha=opacity.value;ctx.globalCompositeOperation=erasing?'destination-out':'source-over';ctx.stroke();});
canvas.addEventListener('pointerup', ()=>{drawing=false;ctx.closePath();});

/* Tools */
eraserBtn.addEventListener('click', ()=>{erasing=true;});
penBtn.addEventListener('click', ()=>{erasing=false;});
clearBtn.addEventListener('click', ()=>{ctx.clearRect(0,0,canvas.width,canvas.height);});
undoBtn.addEventListener('click', ()=>{}); // simplified
redoBtn.addEventListener('click', ()=>{});

/* Init */
window.addEventListener('load', ()=>{newBtn.click();});
</script>
</body>
</html>
